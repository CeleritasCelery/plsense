これは何？
==========

Perlソースコードのコンテキストに合った補完/ヘルプ情報を提供するPerlモジュールです。  
EmacsやVimなどの高機能エディタから利用されることを前提に設計しています。


特徴
====

### 補完/ヘルプ/メソッド情報の表示

指定されたソースコードのコンテキストを特定し、適切な補完/ヘルプ/メソッド情報を表示します。

### 特定可能なコンテキスト

* 変数
* インスタンスメソッド
* クラスのイニシャライザ
* use/requireモジュール
* use/requireするモジュールに渡すLIST要素
* ハッシュキー


スクリーンショット
==================

本モジュールをEmacsで利用した場合のスクリーンショットです。

![demo1](image/demo1.png)


デモ
====

本モジュールをEmacsで利用した場合に可能になる、コーディングのデモです。

http://www.youtube.com/watch?v=Q8XDhxqmaXs

Emacsでの利用に関して、詳しくは以下を参照して下さい。

https://github.com/aki2o/emacs-plsense/blob/master/README-ja.md


インストール
============

### CPANからインストール

2013/07/24  CPANにアップロードするための申請中ですが、一向に申請が通る気配がありません。

### cpanmでインストール

    # git clone https://github.com/aki2o/plsense.git
    # cd plsense
    # cpanm PlSense-?.??.tar.gz

### 手動でインストール

    # git clone https://github.com/aki2o/plsense.git
    # cd plsense
    # perl Makefile.PL
    # make
    # make manifest
    # make test
    # make instal

手動の場合、依存モジュールがインストールされていないとエラーになると思います。  
都度、インストールして頂くか、Makefile.PLを参照して下さい。

### インストール確認

本モジュールのインストールにより、plsenseコマンドが提供されます。  
ターミナルから`plsense -v`を実行してみて下さい。  
本モジュールのバージョン情報が表示されるはずです。


設定
====

### 全般

本モジュールには、全般的な動作を決定する以下の設定項目があります。

* cachedir ... ソースコードの解析結果を保存するディレクトリパス
* maxtasks ... 同時実行するタスクの最大数
* port1, port2, port3 ... サーバプロセスが待ち受けるポート番号
* logfile ... ログ出力先ファイル
* loglevel ... ログ出力レベル

※ cachedirに保存する情報は継続して利用可能なので、/tmpなどの一時領域でない方が良いです。  
※ 頻繁にI/Oが発生するので、cachedirに指定するパスは高速なデバイスの方が良いです。  
※ cachedirに必要な容量、maxtasksの指定数に関しては、消費リソースを参照して下さい。  
※ 本モジュールはサーバ/クライアントモデルで動作し、サーバプロセスが3つ実行されます。  
※ ログファイルが未指定の場合、ログ出力しません。  
※ ログ出力には Log::Handler を利用しています。指定できるログレベル名については、 Log::Handler のヘルプを参照して下さい。  

#### 設定ファイル

上記の設定項目は`plsense --cachedir=...`のようにコマンドライン指定できます。  
また、ユーザのホームディレクトリに .plsense というファイルで設定を記述することで、コマンドライン指定を省略できます。

    # cat ~/.plsense
    cachedir=/home/user1/.plsense.d
    logfile=/tmp/plsense.log
    loglevel=info
    maxtasks=20
    port1=33333
    port2=33334
    port3=33335

※ 上記ファイルは、事前に作成しなくても、plsenseコマンド実行時に作成できます。  
※ コマンドライン引数の指定は、上記ファイルの記述より優先されます。  

### プロジェクト固有

プロジェクト固有のライブラリがある場合など、複数ファイルを相互に参照するケースでは、
プロジェクトツリーのルートに .plsense というファイルでプロジェクト情報を記述する必要があります。

    # cat /var/dev/sample/.plsense 
    name=SampleProj
    lib-path=lib

* name ... プロジェクト名。[a-zA-Z0-9_]+
* lib-path ... プロジェクト固有ライブラリへの相対パス。上記の場合、 /var/dev/sample/lib になる。


消費リソース
============

解析したモジュール数や、そのモジュールのサイズによって大分変わりますが、一応の目安を示します。

約200のモジュールを解析した場合、

* cachedirに保存される容量は、約20MB
* サーバプロセスが常時使用するメモリが、合計で約100MB

その他に、不定期にサーバプロセスから起動される、ライブラリ検索やソース解析のタスクのプロセスが
消費するメモリが平均25MBです。

maxtasksは、そのタスクの最大同時実行数なので、お使いのマシンの搭載メモリに合わせて、適宜設定して下さい。  
デフォルトは20です。つまり、上記の場合、一時的に最大600MB程消費することになります。

また、モジュールの解析は、再帰的に行われます。  
例えば、対象のソースコードがuse/requireしているモジュール数が少なくても、
そのモジュールが大量のuse/requireをしていた場合は、解析するモジュール数は多くなります。


所要時間
========

補完/ヘルプ情報の提供は、即座に可能ですが、その結果が最適化されるためには、
未解析の全てのモジュールを解析する必要があり、その完了までにはある程度の時間が必要です。

これも、対象のソースコードから参照される未解析の総モジュール数に依存しますが、一応の目安として、

約200のモジュールをmaxtasksが20の設定で解析した場合、完了までに約15分が必要でした。


解析における制限事項
====================

### 配列



### ハッシュ

### モジュールが提供する記述



拡張性
======



使い方
======

本モジュールのインストールにより、提供されるplsenseコマンドを通して、サーバとやり取りします。  
plsenseコマンドが備えているサブコマンドについて、以下に記します。  

本モジュールは、EmacsやVimなどの高機能エディタから利用されることを前提に設計しているため、
エンドユーザが通常意識する必要はありません。

### help

### svstart/serverstart




動作確認
========

* WindowsXP Pro SP3 32bit
* Cygwin 1.7.20-1
* Perl 5.14.2


**Enjoy!!!**

